<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pinfolio Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#f2ede5;
  --panel:#ffffff;
  --accent:#b8a98f;
  --dark:#2a2a2a;
  --muted:#777;
  --radius:18px;
}

* { box-sizing:border-box; margin:0; padding:0; }

body {
  font-family:'Poppins',sans-serif;
  background:var(--bg);
  display:flex;
  height:100vh;
}

/* SIDEBAR */
.sidebar {
  width:260px;
  background:var(--panel);
  padding:30px 20px;
  box-shadow:5px 0 25px rgba(0,0,0,0.05);
  display:flex;
  flex-direction:column;
}

.sidebar h2 {
  text-align:center;
  letter-spacing:2px;
  margin-bottom:40px;
}

.sidebar button {
  margin-bottom:15px;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#f5f2ec;
  color:var(--dark);
  font-weight:600;
  cursor:pointer;
  transition:0.3s;
}

.sidebar button.active,
.sidebar button:hover {
  background:var(--accent);
  color:white;
}

/* MAIN */
.main {
  flex:1;
  padding:35px;
  overflow-y:auto;
}

.section { display:none; }
.section.active { display:block; }

/* HEADERS */
h2 { margin-bottom:20px; }

/* FORM */
.form-box {
  background:white;
  max-width:500px;
  padding:30px;
  border-radius:var(--radius);
  box-shadow:0 10px 30px rgba(0,0,0,0.06);
}

.form-box input, .form-box textarea {
  width:100%;
  padding:12px;
  margin-bottom:15px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:1rem;
}

.form-box button {
  width:100%;
  padding:12px;
  background:var(--accent);
  color:white;
  border:none;
  border-radius:30px;
  font-weight:600;
  cursor:pointer;
}

/* PRODUCT GRID */
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:25px;
}

.card {
  background:white;
  border-radius:var(--radius);
  box-shadow:0 8px 25px rgba(0,0,0,0.05);
  overflow:hidden;
  transition:0.3s;
}

.card:hover { transform:translateY(-5px); }

.card img {
  width:100%;
  height:180px;
  object-fit:contain;
  background:#f7f7f7;
  padding:10px;
}

.card .info {
  padding:15px;
}

.card h4 { margin-bottom:5px; }
.card p { color:var(--muted); font-size:0.9rem; }

/* ACTION BUTTONS */
.actions {
  margin-top:10px;
  display:flex;
  gap:8px;
}

.actions button {
  flex:1;
  padding:8px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-size:0.85rem;
}

.delete { background:#ff5c5c; color:white; }
.toggle { background:#444; color:white; }

/* ANALYTICS */
.stat {
  background:white;
  padding:30px;
  max-width:300px;
  border-radius:var(--radius);
  box-shadow:0 10px 30px rgba(0,0,0,0.06);
  text-align:center;
}
.stat h1 { font-size:3rem; }
.stat p { color:var(--muted); }
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <h2>PINFOLIO</h2>
  <button id="btnProducts" class="active" onclick="show('products')">Products</button>
  <button id="btnAdd" onclick="show('add')">Add Product</button>
  <button id="btnAnalytics" onclick="show('analytics')">Analytics</button>
</div>

<!-- MAIN -->
<div class="main">

  <!-- PRODUCTS -->
  <div id="products" class="section active">
    <h2>All Products</h2>
    <div class="grid" id="productGrid"></div>
  </div>

  <!-- ADD PRODUCT -->
  <div id="add" class="section">
    <h2>Add New Product</h2>

    <div class="form-box">
      <input type="text" id="title" placeholder="Product Title" required>
      <textarea id="desc" placeholder="Description"></textarea>
      <input type="text" id="link" placeholder="Product Link">
      <input type="text" id="image" placeholder="Image URL (required)">
      <button onclick="addProduct()">Add Product</button>
      <p id="msg"></p>
    </div>
  </div>

  <!-- ANALYTICS -->
  <div id="analytics" class="section">
    <h2>Analytics</h2>
    <div class="stat">
      <h1 id="totalProducts">0</h1>
      <p>Total Products</p>
    </div>
  </div>

</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCaIDSNGdwZs3VJk5gVbvb6UGeKP6u5dx8",
  authDomain: "pinfolio-55246.firebaseapp.com",
  projectId: "pinfolio-55246",
  storageBucket: "pinfolio-55246.appspot.com",
  messagingSenderId: "864326590674",
  appId: "1:864326590674:web:7e4ec37e91f0ac92c2cd0b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const grid = document.getElementById("productGrid");
const totalProducts = document.getElementById("totalProducts");
const msg = document.getElementById("msg");

/* NAV */
window.show = (id) => {
  document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
  document.querySelectorAll(".sidebar button").forEach(b => b.classList.remove("active"));
  document.getElementById(id).classList.add("active");

  if (id === "products") btnProducts.classList.add("active");
  if (id === "add") btnAdd.classList.add("active");
  if (id === "analytics") btnAnalytics.classList.add("active");
};

/* LOAD PRODUCTS */
onSnapshot(collection(db,"products"), (snapshot) => {
  grid.innerHTML = "";
  totalProducts.innerText = snapshot.size;

  snapshot.forEach(docSnap => {
    const p = docSnap.data();

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${p.image}">
      <div class="info">
        <h4>${p.title}</h4>
        <p>${p.desc || ""}</p>
        <div class="actions">
          <button class="delete" onclick="deleteProduct('${docSnap.id}')">Delete</button>
          <button class="toggle" onclick="toggleShow('${docSnap.id}', ${p.show !== false})">
            ${p.show === false ? "Show" : "Hide"}
          </button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
});

/* ADD PRODUCT */
window.addProduct = async () => {
  try {
    const title = document.getElementById("title").value;
    const desc = document.getElementById("desc").value;
    const link = document.getElementById("link").value;
    const image = document.getElementById("image").value;

    if (!title || !image) {
      msg.innerText = "❌ Title & Image URL required";
      return;
    }

    await addDoc(collection(db,"products"), {
      title, desc, link, image, show:true
    });

    msg.innerText = "✅ Product added successfully!";
    title.value = desc.value = link.value = image.value = "";

  } catch (err) {
    msg.innerText = "❌ " + err.message;
  }
};

/* DELETE */
window.deleteProduct = async (id) => {
  if (confirm("Delete this product?")) {
    await deleteDoc(doc(db,"products",id));
  }
};

/* SHOW / HIDE */
window.toggleShow = async (id,current) => {
  await updateDoc(doc(db,"products",id), { show: !current });
};
</script>

</body>
</html>
